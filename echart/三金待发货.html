<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>ECharts</title>
    <script src="./js/jquery-2.1.3.min.js"></script>
    <!-- 引入 echarts.js -->
    <script src="./js/echarts.min.js"></script>
    <script>var echarts4 = echarts</script>
</head>

<body>
    <!-- 为ECharts准备一个具备大小（宽高）的Dom -->
    <table>
        <thead>
            <th></th>
            <th></th>
        </thead>
        <tbody>
            <tr>
                <td>
                    <div id="main" style="width: 1400px;height:600px;"></div>
                </td>
                <td valign="top">
                    <div id="main_not_abut" style="width: 400px;height:300px;"></div>
                    <div id="main_order_detail" style="width: 400px;height:300px;"></div>
                </td>
            </tr>
            
        </tbody>
    </table>
    
    
    <script type="text/javascript" src="./data/order.json"></script>

    <script type="text/javascript">
    myChart = echarts4.init(document.getElementById('main'));
    myChart1 = echarts4.init(document.getElementById('main_not_abut'));
    myChart_detail = echarts4.init(document.getElementById('main_order_detail'));
    var legend_names = []
    var data = []
    var xaxis_data = order_data['xaxis']
    console.log(order_data)

    
    
    order_data['abut_data'].forEach(function(v) {
        legend_names.push(v['name']);
        data.push({
            name: v['name'],
            type: 'bar',
            stack: 'all',
            label: {
                normal: {
                    show: true,
                    position: "insideLeft",
                    offset:[15,0],
                    formatter:function(item){
                        value = item['value'] === 0?"":item['value']
                        return value
                    }
                }
            },
            // itemStyle:{
            //     color:"#FF0000"
            // },
            data: v['data']
        })
    });
    data.push({
        name:order_data['order_data']['name'],
        type:'line',
        data:order_data['order_data']['data'],
        label: {
            normal: {
                show: true,
                // position: "insideLeft",
                // offset:[15,0],
                formatter:function(item){
                    value = item['value'] === 0?"":item['value']
                    return value
                }
            }
        },
    })
    // 将下单数 前置与
    legend_names.unshift(order_data['order_data']['name'])
    


    option = {
        title:{
            text:'已对接待回复'
        },
        tooltip: {
            trigger: 'axis',
            axisPointer: { // 坐标轴指示器，坐标轴触发有效
                type: 'shadow' // 默认为直线，可选为：'line' | 'shadow'
            },
            formatter:function(item){
   
                var total = 0
                var temp = ""
                item.forEach(function(v){
                    temp +=  v['marker'] + v['seriesName'] 
                    + "：" + v['value'] +"</br>"
                    total += v['value']
                })
                temp = item[0]['name'] + "</br>" + `总计：${total}</br>` + temp

                return temp
            }
        },
        
        legend: {
            data:legend_names
        },

        toolbox: {
            show: true,
            left:"80%",
            feature: {
                dataZoom: {
                    yAxisIndex: 'none'
                },
                // dataView: {readOnly: false},
                magicType: {type: ['line', 'bar']},
                restore: {},
                saveAsImage: {}
            }
        },
        grid: {
            left: '3%',
            right: '4%',
            bottom: '3%',
            containLabel: true
        },
        xAxis: {
            type: 'category',

            data: xaxis_data,
            axisLabel:{
                rotate:45,
                formatter:function(value,index){
                    let day = "星期" + "日一二三四五六".charAt(new Date(value).getDay())
                    // console.log(value)
                    return value + "\n" + day
                }
            }


        },
        yAxis: {
            type: 'value'
        },
        series: data
    };
    console.log(option)
    myChart.setOption(option)

    myChart.on('click',function(item){
        console.log(item)
        // componentType: "series"
        // seriesName: "是"
        // name: "2019-12-21"
        // value: 11
        // color: "#61a0a8"
        if (item["componentType"] === "series" && 
            (item["seriesName"] === "待回复" || item["seriesName"] === "下单数")){
            
            let title_text,data_are,handle_chart
            if (item["seriesName"] === "待回复"){
                title_text = item["name"]+'对接待回复';
                data_are = "not_abut_data";
                handle_chart = myChart1;
            }else if(item['seriesName'] === "下单数"){
                title_text = item["name"]+'下单详情';
                data_are = "order_details";
                handle_chart = myChart_detail;
            }
            

            let xaxis_data = []
            
            let values = []
            for (k in order_data[data_are][item["name"]]){
                v = order_data[data_are][item["name"]][k]
                xaxis_data.push(k)
                values.push(v)
            }
            
            let legend_names = xaxis_data

            let data = {
                name:item["name"],
                type:"bar",
                data:values,
                itemStyle:{
                    color:item["color"]
                },
                label: {
                    normal: {
                        show: true,
                        position: "insideLeft",
                        offset:[15,0],
                        // formatter:function(item){
                        //     value = item['value'] === 0?"":item['value']
                        //     return value
                        // }
                    }
                },
            }
            // console.log(data)
            // console.log(xaxis_data)
            option = {
                title:{
                    text:title_text
                },
                tooltip: {
                    trigger: 'axis',
     
                },

                toolbox: {
                    show: true,
                    feature: {
                        dataZoom: {
                            yAxisIndex: 'none'
                        },
                        // dataView: {readOnly: false},
                        // magicType: {type: ['line', 'bar']},
                        restore: {},
                        saveAsImage: {}
                    }
                },

                // legend: {
                //     data:legend_names
                // },
                xAxis: {
                    type: 'category',
                    data: xaxis_data

                },
                yAxis: {
                    type: 'value'
                },
                series: data
            };
            console.log(option)
            handle_chart.setOption(option);

        };

        
    })
    </script>
</body>

</html>